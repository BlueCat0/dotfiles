#!/usr/bin/env zsh

set -uo pipefail

on-ERR() {
  local status=$?
  echo >&2 Error executing run_onchange_after_install-1-ubuntu-packages.sh.tmpl
  exit ${status}
}

trap on-ERR ERR

if [[ "${CHEZMOI_VERBOSE:-}" == 1 ]]; then
  if "${DEBUG_SCRIPTS:-false}"; then
    set -x
  fi
fi

case "$(lsb_release -is)" in
  Ubuntu)
  # apt
  sudo apt update -q -o=Dpkg::Use-Pty=0
  sudo apt upgrade -y -q -o=Dpkg::Use-Pty=0
  # Brewfile: {{ include (joinPath .chezmoi.workingTree "setup/ubuntu/pkglist.list") | sha256sum }}
  xargs sudo apt install -y -q -o=Dpkg::Use-Pty=0 < "{{ .chezmoi.workingTree }}/setup/ubuntu/pkglist.list"
  # snap
  sudo snap install chezmoi --classic
  sudo snap install bw

  # asdf
  if [ ! -d ~/.asdf ]; then
    git clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.14.0 -q
  fi
  
  # eza

  # antidote
  if [ ! -d ~/.antidote ]; then
    git clone --depth=1 https://github.com/mattmc3/antidote.git ~/.antidote -q
  fi
  ;;
*) : ;;
esac
